## Copyright 2021 Henning Thiesen

## OpInMod is released under the open source MIT License, see
## https://github.com/hnnngt/OpInMod/blob/main/LICENSE

"""Function to calculate synthetic inertia provision from WT

"""

from scipy.interpolate import interp1d

"""`NREL 5MW wind turbine data <https://doi.org/10.2172/947422>`

"""

speedVsPowerSpeed = [0.5, 0.50063, 0.50125, 0.50188, 0.5293, 0.58223, 0.63516, 0.6881, 0.74103,	0.79396, 0.84689, 0.89982, 0.95275,	1.00568, 1.05861, 1.11154,	1.16447, 1.18344, 1.68344, 1.69344,	1.70344, 1.71344, 1.72344]

speedVsPowerPower = [0.016704, 0.029204, 0.041704, 0.054204, 0.089346, 0.118918, 0.154388, 0.196292, 0.245164, 0.30154, 0.365958, 0.438954, 0.521062, 0.61282, 0.714764, 0.827428, 0.95135, 1, 1.0001, 1.000102, 1.000104, 1.000106, 1.000108]

speedVsVarHSpeed = [0.0, 0.67, 0.672, 0.674, 0.676, 0.678, 0.68, 0.682, 0.684, 0.686, 0.688, 0.69, 0.692, 0.694, 0.696, 0.698, 0.7, 0.702, 0.704, 0.706, 0.708, 0.71, 0.712, 0.714, 0.716, 0.718, 0.72, 0.722, 0.724, 0.726, 0.728, 0.73, 0.732, 0.734, 0.736, 0.738, 0.74, 0.742, 0.744, 0.746, 0.748, 0.75, 0.752, 0.754, 0.756, 0.758, 0.76, 0.762, 0.764, 0.766, 0.768, 0.77, 0.772, 0.774, 0.776, 0.778, 0.78, 0.782, 0.784, 0.786, 0.788, 0.79, 0.792, 0.794, 0.796, 0.798, 0.8, 0.802, 0.804, 0.806, 0.808, 0.81, 0.812, 0.814, 0.816, 0.818, 0.82, 0.822, 0.824, 0.826, 0.828, 0.83, 0.832, 0.834, 0.836, 0.838, 0.84, 0.842, 0.844, 0.846, 0.848, 0.85, 0.852, 0.854, 0.856, 0.858, 0.86, 0.862, 0.864, 0.866, 0.868, 0.87, 0.872, 0.874, 0.876, 0.878, 0.88, 0.882, 0.884, 0.886, 0.888, 0.89, 0.892, 0.894, 0.896, 0.898, 0.9, 0.902, 0.904, 0.906, 0.908, 0.91, 0.912, 0.914, 0.916, 0.918, 0.92, 0.922, 0.924, 0.926, 0.928, 0.93, 0.932, 0.934, 0.936, 0.938, 0.94, 0.942, 0.944, 0.946, 0.948, 0.95, 0.952, 0.954, 0.956, 0.958, 0.96, 0.962, 0.964, 0.966, 0.968, 0.97, 0.972, 0.974, 0.976, 0.978, 0.98, 0.982, 0.984, 0.986, 0.988, 0.99, 0.992, 0.994, 0.996, 0.998, 1.0, 1.002, 1.004, 1.006, 1.008, 1.01, 1.012, 1.014, 1.016, 1.018, 1.02, 1.022, 1.024, 1.026, 1.028, 1.03, 1.032, 1.034, 1.036, 1.038, 1.04, 1.042, 1.044, 1.046, 1.048, 1.05, 1.052, 1.054, 1.056, 1.058, 1.06, 1.062, 1.064, 1.066, 1.068, 1.07, 1.072, 1.074, 1.076, 1.078, 1.08, 1.082, 1.084, 1.086, 1.088, 1.09, 1.092, 1.094, 1.096, 1.098, 1.1, 1.102, 1.104, 1.106, 1.108, 1.11, 1.112, 1.114, 1.116, 1.118, 1.12, 1.122, 1.124, 1.126, 1.128, 1.13, 1.132, 1.134, 1.136, 1.138, 1.14, 1.142, 1.144, 1.146, 1.148, 1.15, 1.152, 1.154, 1.156, 1.158, 1.16, 1.162, 1.164, 1.166, 1.168, 1.17, 1.172, 1.174, 1.176, 1.178, 1.18, 1.182, 1.184, 1.186, 1.188, 1.19, 1.192, 1.194, 1.196, 1.198, 1.2, 1.202, 1.204, 1.206, 1.208, 1.21, 1.212, 1.214, 1.216, 1.218, 1.22, 1.222, 1.224, 1.226, 1.228, 1.23, 1.232, 1.234, 1.236, 1.238, 1.24, 1.242, 1.244, 1.246, 1.248, 1.25, 1.252, 1.254, 1.256, 1.258, 1.26, 1.262, 1.264, 1.266, 1.268, 1.27, 1.272, 1.274, 1.276, 1.278, 1.28, 1.282, 1.284, 1.286, 1.288, 1.29, 1.292, 1.294, 1.296, 1.298, 1.3]

speedVsVarHVarH = [0.0, 0.0, 0.002890149477906, 0.005788913410292, 0.008696291797158, 0.011612284638503, 0.014536891934328, 0.017470113684633, 0.020411949889417, 0.02336240054868, 0.026321465662424, 0.029289145230646, 0.032265439253349, 0.035250347730531, 0.038243870662193, 0.041246008048334, 0.044256759888955, 0.047276126184055, 0.050304106933635, 0.053340702137695, 0.056385911796234, 0.059439735909253, 0.062502174476752, 0.06557322749873, 0.068652894975188, 0.071741176906125, 0.074838073291542, 0.077943584131438, 0.081057709425814, 0.08418044917467, 0.087311803378005, 0.09045177203582, 0.093600355148115, 0.096757552714889, 0.099923364736143, 0.103097791211876, 0.106280832142089, 0.109472487526781, 0.112672757365953, 0.115881641659605, 0.119099140407737, 0.122325253610347, 0.125559981267438, 0.128803323379008, 0.132055279945058, 0.135315850965587, 0.138585036440596, 0.141862836370085, 0.145149250754053, 0.148444279592501, 0.151747922885428, 0.155060180632835, 0.158381052834721, 0.161710539491088, 0.165048640601933, 0.168395356167259, 0.171750686187064, 0.175114630661348, 0.178487189590112, 0.181868362973356, 0.185258150811079, 0.188656553103282, 0.192063569849965, 0.195479201051127, 0.198903446706769, 0.20233630681689, 0.205777781381491, 0.209227870400572, 0.212686573874132, 0.216153891802172, 0.219629824184691, 0.22311437102169, 0.226607532313169, 0.230109308059127, 0.233619698259565, 0.237138702914482, 0.240666322023879, 0.244202555587756, 0.247747403606112, 0.251300866078948, 0.254862943006263, 0.258433634388058, 0.262012940224333, 0.265600860515087, 0.269197395260321, 0.272802544460034, 0.276416308114227, 0.2800386862229, 0.283669678786052, 0.287309285803684, 0.290957507275795, 0.294614343202386, 0.298279793583457, 0.301953858419007, 0.305636537709037, 0.309327831453546, 0.313027739652535, 0.316736262306004, 0.320453399413952, 0.32417915097638, 0.327913516993287, 0.331656497464675, 0.335408092390541, 0.339168301770887, 0.342937125605713, 0.346714563895019, 0.350500616638804, 0.354295283837068, 0.358098565489813, 0.361910461597037, 0.36573097215874, 0.369560097174923, 0.373397836645586, 0.377244190570728, 0.38109915895035, 0.384962741784451, 0.388834939073032, 0.392715750816093, 0.396605177013633, 0.400503217665653, 0.404409872772153, 0.408325142333132, 0.41224902634859, 0.416181524818529, 0.420122637742947, 0.424072365121844, 0.428030706955221, 0.431997663243078, 0.435973233985414, 0.43995741918223, 0.443950218833526, 0.447951632939301, 0.451961661499555, 0.45598030451429, 0.460007561983504, 0.464043433907197, 0.46808792028537, 0.472141021118023, 0.476202736405155, 0.480273066146767, 0.484352010342859, 0.48843956899343, 0.49253574209848, 0.496640529658011, 0.500753931672021, 0.50487594814051, 0.509006579063479, 0.513145824440928, 0.517293684272856, 0.521450158559264, 0.525615247300152, 0.529788950495519, 0.533971268145366, 0.538162200249692, 0.542361746808498, 0.546569907821784, 0.550786683289549, 0.555012073211793, 0.559246077588518, 0.563488696419722, 0.567739929705405, 0.571999777445569, 0.576268239640211, 0.580545316289334, 0.584831007392936, 0.589125312951017, 0.593428232963578, 0.597739767430619, 0.60205991635214, 0.606388679728139, 0.610726057558619, 0.615072049843578, 0.619426656583017, 0.623789877776936, 0.628161713425333, 0.632542163528211, 0.636931228085568, 0.641328907097405, 0.645735200563721, 0.650150108484517, 0.654573630859793, 0.659005767689548, 0.663446518973783, 0.667895884712497, 0.672353864905691, 0.676820459553365, 0.681295668655518, 0.685779492212151, 0.690271930223263, 0.694772982688855, 0.699282649608927, 0.703800930983478, 0.708327826812509, 0.712863337096019, 0.71740746183401, 0.721960201026479, 0.726521554673428, 0.731091522774857, 0.735670105330766, 0.740257302341154, 0.744853113806021, 0.749457539725368, 0.754070580099195, 0.758692234927502, 0.763322504210288, 0.767961387947554, 0.772608886139299, 0.777264998785524, 0.781929725886228, 0.786603067441412, 0.791285023451076, 0.795975593915219, 0.800674778833842, 0.805382578206944, 0.810098992034527, 0.814824020316588, 0.819557663053129, 0.82429992024415, 0.829050791889651, 0.833810277989631, 0.838578378544091, 0.84335509355303, 0.848140423016449, 0.852934366934347, 0.857736925306725, 0.862548098133583, 0.86736788541492, 0.872196287150737, 0.877033303341034, 0.881878933985809, 0.886733179085065, 0.8915960386388, 0.896467512647015, 0.90134760110971, 0.906236304026884, 0.911133621398537, 0.916039553224671, 0.920954099505284, 0.925877260240376, 0.930809035429948, 0.935749425074, 0.940698429172531, 0.945656047725542, 0.950622280733033, 0.955597128195003, 0.960580590111453, 0.965572666482382, 0.970573357307791, 0.975582662587679, 0.980600582322047, 0.985627116510895, 0.990662265154223, 0.99570602825203, 1.00075840580432, 1.00581939781108, 1.01088900427233, 1.01596722518805, 1.02105406055826, 1.02614951038294, 1.03125357466211, 1.03636625339575, 1.04148754658387, 1.04661745422648, 1.05175597632356, 1.05690311287512, 1.06205886388116, 1.06722322934168, 1.07239620925669, 1.07757780362617, 1.08276801245013, 1.08796683572857, 1.09317427346149, 1.09839032564888, 1.10361499229076, 1.10884827338712, 1.11409016893796, 1.11934067894328, 1.12459980340307, 1.12986754231735, 1.13514389568611, 1.14042886350934, 1.14572244578706, 1.15102464251925, 1.15633545370593, 1.16165487934708, 1.16698291944272, 1.17231957399283, 1.17766484299742, 1.18301872645649, 1.18838122437005, 1.19375233673808, 1.19913206356059, 1.20452040483758, 1.20991736056905, 1.215322930755, 1.22073711539543, 1.22615991449034, 1.23159132803973, 1.2370313560436, 1.24247999850195, 1.24793725541477, 1.25340312678208, 1.25887761260387, 1.26436071288014, 1.26985242761088, 1.27535275679611, 1.28086170043581, 1.28637925853, 1.29190543107866, 1.29744021808181, 1.30298361953943, 1.30853563545153, 1.31409626581812, 1.31966551063918, 1.32524336991472, 1.33082984364474, 1.33642493182925]

# interpolation of wind turbine characteristics
speed_power_inter = interp1d(speedVsPowerPower,
                             speedVsPowerSpeed,
                             fill_value=0,
                             bounds_error=False)

speed_varH_inter = interp1d(speedVsVarHSpeed,
                            speedVsVarHVarH,
                            fill_value=0,
                            bounds_error=False)

# set up function to calculate var H inertia constant
def calc_inertia_wind(cap):
    speed = speed_power_inter(cap)
    varH = speed_varH_inter(speed)
    return varH
